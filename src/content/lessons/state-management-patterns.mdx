---
title: 'çŠ¶æ…‹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šè¨­è¨ˆã®é¸æŠè‚¢'
slug: 'state-management-patterns'
description: 'çŠ¶æ…‹ã®ã‚¹ã‚³ãƒ¼ãƒ—åˆ¤æ–­ã€useState/useReducer/Context/å¤–éƒ¨ã‚¹ãƒˆã‚¢ã®ä½¿ã„åˆ†ã‘ã‚’å­¦ã³ã¾ã™ã€‚'
tags: ['react', 'state', 'architecture', 'patterns', 'advanced']
difficulty: 'advanced'
estimatedMinutes: 30
prerequisites: ['context-patterns']
---

# çŠ¶æ…‹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šè¨­è¨ˆã®é¸æŠè‚¢

## å­¦ç¿’ç›®æ¨™

ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

1. **çŠ¶æ…‹ã®ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆLocal / Lifted / Globalï¼‰ã‚’åˆ¤æ–­ã—ã€é©åˆ‡ãªç®¡ç†æ–¹æ³•ã‚’é¸æŠã§ãã‚‹**
2. **ã€Œã“ã®çŠ¶æ…‹ã¯èª°ãŒä½¿ã†ã‹ã€ã€Œã„ã¤æ¶ˆãˆã‚‹ã¹ãã‹ã€ã‚’è¨€èªåŒ–ã§ãã‚‹**
3. **ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã‚’ã€Œæœ€å¾Œã®æ‰‹æ®µã€ã¨ç†è§£ã—ã€éå‰°ãªã‚°ãƒ­ãƒ¼ãƒãƒ«åŒ–ã‚’é¿ã‘ã‚‰ã‚Œã‚‹**

---

## çŠ¶æ…‹ç®¡ç†ã§ã‚„ã£ã¦ã„ã„ã“ã¨ / ã‚„ã‚‰ãªãã¦ã„ã„ã“ã¨

### ã‚„ã£ã¦ã„ã„ã“ã¨
- çŠ¶æ…‹ã¯**ä½¿ã†å ´æ‰€ã«ä¸€ç•ªè¿‘ã„ã¨ã“ã‚**ã§ç®¡ç†
- è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…±æœ‰ãŒå¿…è¦ãªå ´åˆã®ã¿ã€ä¸Šã«æŒã¡ä¸Šã’ã‚‹
- ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ã‚’æ˜ç¢ºã«åˆ†é›¢
- çŠ¶æ…‹ã®å¯¿å‘½ï¼ˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼‰ã‚’æ„è­˜ã™ã‚‹

### ã‚„ã‚‰ãªãã¦ã„ã„ã“ã¨
- ã€Œã‚ã¨ã§ä½¿ã†ã‹ã‚‚ã€ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã™ã‚‹
- ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‹é–‰çŠ¶æ…‹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒˆã‚¢ã«å…¥ã‚Œã‚‹
- 1ã¤ã®Reducerã«å…¨æ©Ÿèƒ½ã‚’è©°ã‚è¾¼ã‚€
- UIã®è¦‹ãŸç›®çŠ¶æ…‹ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æ··ãœã‚‹

### çŠ¶æ…‹ã‚¹ã‚³ãƒ¼ãƒ—ã®åˆ¤æ–­åŸºæº–

| è³ªå• | Yes â†’ | No â†’ |
|------|-------|------|
| ã“ã®çŠ¶æ…‹ã‚’ä½¿ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯1ã¤ã ã‘ï¼Ÿ | Localï¼ˆuseStateï¼‰ | æ¬¡ã®è³ªå•ã¸ |
| è¦ªå­é–¢ä¿‚ã§å…±æœ‰ã§ãã‚‹ï¼Ÿ | Liftedï¼ˆprops drill / çŠ¶æ…‹ã®æŒã¡ä¸Šã’ï¼‰ | æ¬¡ã®è³ªå•ã¸ |
| æ›´æ–°é »åº¦ã¯ä½ã„ï¼Ÿï¼ˆãƒ†ãƒ¼ãƒã€èªè¨¼ãªã©ï¼‰ | Context | æ¬¡ã®è³ªå•ã¸ |
| æ›´æ–°é »åº¦ãŒé«˜ã„ / è¤‡é›‘ãªçŠ¶æ…‹é·ç§»ï¼Ÿ | å¤–éƒ¨ã‚¹ãƒˆã‚¢ï¼ˆZustand, Jotaiç­‰ï¼‰ | è¨­è¨ˆã‚’è¦‹ç›´ã™ |

---

## çŠ¶æ…‹ã®å¯¿å‘½ã‚’æ„è­˜ã™ã‚‹

```
çŠ¶æ…‹ã®å¯¿å‘½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
çŸ­ã„                                           é•·ã„

[ä¸€æ™‚çš„]         [ãƒšãƒ¼ã‚¸]        [ã‚»ãƒƒã‚·ãƒ§ãƒ³]    [æ°¸ç¶š]
â”œâ”€ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰   â”œâ”€ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›   â”œâ”€ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹   â”œâ”€ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
â”œâ”€ãƒ›ãƒãƒ¼çŠ¶æ…‹     â”œâ”€é¸æŠã‚¢ã‚¤ãƒ†ãƒ    â”œâ”€ã‚«ãƒ¼ãƒˆå†…å®¹     â”œâ”€é–²è¦§å±¥æ­´
â”œâ”€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ â”œâ”€æ¤œç´¢çµæœ       â”œâ”€ãƒ†ãƒ¼ãƒè¨­å®š     â””â”€ãŠæ°—ã«å…¥ã‚Š
â””â”€ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—   â””â”€ã‚½ãƒ¼ãƒˆé †       â””â”€é€šçŸ¥è¨­å®š

ç®¡ç†æ–¹æ³•:
useState        useState/      Context/        localStorage +
               useReducer     å¤–éƒ¨ã‚¹ãƒˆã‚¢      å¤–éƒ¨ã‚¹ãƒˆã‚¢
```

**åŸå‰‡**: å¯¿å‘½ãŒçŸ­ã„çŠ¶æ…‹ã»ã©Localã«ã€é•·ã„çŠ¶æ…‹ã»ã©ä¸Šä½ã§ç®¡ç†ã€‚

---

## å‹•ä½œã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

**ãƒã‚¤ãƒ³ãƒˆ**: çŠ¶æ…‹ã®ã‚¹ã‚³ãƒ¼ãƒ—åˆ¤æ–­ã€Local vs Lifted vs Global ã®å®Ÿè·µã€è²¬å‹™åˆ†é›¢ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```tsx
import { useState, useReducer, createContext, useContext, useMemo, ReactNode } from 'react';

// ============================================
// 1. Local Stateï¼ˆuseStateï¼‰- 1ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…
// ============================================

// âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ã¯ Local ã§ååˆ†
function ProductCard({ product }: { product: Product }) {
  // ã“ã®çŠ¶æ…‹ã¯ ProductCard å†…ã§ã—ã‹ä½¿ã‚ãªã„
  const [showDetail, setShowDetail] = useState(false);

  return (
    <div>
      <h3>{product.name}</h3>
      <button onClick={() => setShowDetail(true)}>è©³ç´°ã‚’è¦‹ã‚‹</button>

      {showDetail && (
        <Modal onClose={() => setShowDetail(false)}>
          <ProductDetail product={product} />
        </Modal>
      )}
    </div>
  );
}

// ============================================
// 2. Lifted Stateï¼ˆçŠ¶æ…‹ã®æŒã¡ä¸Šã’ï¼‰- è¦ªå­é–“å…±æœ‰
// ============================================

// âœ… é¸æŠçŠ¶æ…‹ã¯è¦ªã§ç®¡ç†ã—ã€å­ã«propsã§æ¸¡ã™
function ProductList() {
  const [selectedId, setSelectedId] = useState<string | null>(null);
  const products = useProducts(); // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã¯åˆ¥ç®¡ç†

  return (
    <div style={{ display: 'flex', gap: '20px' }}>
      <div>
        {products.map((product) => (
          <ProductItem
            key={product.id}
            product={product}
            isSelected={product.id === selectedId}
            onSelect={() => setSelectedId(product.id)}
          />
        ))}
      </div>

      {/* é¸æŠçŠ¶æ…‹ã‚’å…„å¼Ÿã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ã† */}
      <ProductPreview productId={selectedId} />
    </div>
  );
}

function ProductItem({
  product,
  isSelected,
  onSelect,
}: {
  product: Product;
  isSelected: boolean;
  onSelect: () => void;
}) {
  return (
    <div
      onClick={onSelect}
      style={{
        padding: '12px',
        background: isSelected ? '#e3f2fd' : 'white',
        cursor: 'pointer',
      }}
    >
      {product.name}
    </div>
  );
}

// ============================================
// 3. useReducer - è¤‡é›‘ãªçŠ¶æ…‹é·ç§»
// ============================================

// --- å‹å®šç¾© ---
type CartItem = {
  id: string;
  name: string;
  price: number;
  quantity: number;
};

type CartState = {
  items: CartItem[];
  discountCode: string | null;
};

type CartAction =
  | { type: 'ADD_ITEM'; payload: Omit<CartItem, 'quantity'> }
  | { type: 'REMOVE_ITEM'; payload: string }
  | { type: 'UPDATE_QUANTITY'; payload: { id: string; quantity: number } }
  | { type: 'APPLY_DISCOUNT'; payload: string }
  | { type: 'CLEAR_CART' };

// âœ… è¤‡æ•°ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒçŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹ â†’ useReducer
function cartReducer(state: CartState, action: CartAction): CartState {
  switch (action.type) {
    case 'ADD_ITEM': {
      const existing = state.items.find((item) => item.id === action.payload.id);
      if (existing) {
        return {
          ...state,
          items: state.items.map((item) =>
            item.id === action.payload.id
              ? { ...item, quantity: item.quantity + 1 }
              : item
          ),
        };
      }
      return {
        ...state,
        items: [...state.items, { ...action.payload, quantity: 1 }],
      };
    }

    case 'REMOVE_ITEM':
      return {
        ...state,
        items: state.items.filter((item) => item.id !== action.payload),
      };

    case 'UPDATE_QUANTITY':
      return {
        ...state,
        items: state.items.map((item) =>
          item.id === action.payload.id
            ? { ...item, quantity: action.payload.quantity }
            : item
        ),
      };

    case 'APPLY_DISCOUNT':
      return { ...state, discountCode: action.payload };

    case 'CLEAR_CART':
      return { items: [], discountCode: null };

    default:
      return state;
  }
}

// ============================================
// 4. Context - é›¢ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ä½é »åº¦æ›´æ–°
// ============================================

// --- Cart Context ---
type CartContextType = {
  state: CartState;
  addItem: (item: Omit<CartItem, 'quantity'>) => void;
  removeItem: (id: string) => void;
  updateQuantity: (id: string, quantity: number) => void;
  clearCart: () => void;
  total: number;
  itemCount: number;
};

const CartContext = createContext<CartContextType | null>(null);

export function CartProvider({ children }: { children: ReactNode }) {
  const [state, dispatch] = useReducer(cartReducer, {
    items: [],
    discountCode: null,
  });

  // âœ… æ´¾ç”Ÿå€¤ã¯ useMemo ã§è¨ˆç®—ï¼ˆstateã«äºŒé‡æŒã¡ã—ãªã„ï¼‰
  const total = useMemo(
    () => state.items.reduce((sum, item) => sum + item.price * item.quantity, 0),
    [state.items]
  );

  const itemCount = useMemo(
    () => state.items.reduce((sum, item) => sum + item.quantity, 0),
    [state.items]
  );

  // âœ… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ä½¿ã„ã‚„ã™ãã™ã‚‹
  const addItem = (item: Omit<CartItem, 'quantity'>) => {
    dispatch({ type: 'ADD_ITEM', payload: item });
  };

  const removeItem = (id: string) => {
    dispatch({ type: 'REMOVE_ITEM', payload: id });
  };

  const updateQuantity = (id: string, quantity: number) => {
    dispatch({ type: 'UPDATE_QUANTITY', payload: { id, quantity } });
  };

  const clearCart = () => {
    dispatch({ type: 'CLEAR_CART' });
  };

  // âœ… value ã‚’ useMemo ã§ãƒ¡ãƒ¢åŒ–ï¼ˆä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢ï¼‰
  const value = useMemo(
    () => ({
      state,
      addItem,
      removeItem,
      updateQuantity,
      clearCart,
      total,
      itemCount,
    }),
    [state, total, itemCount]
  );

  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;
}

export function useCart() {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error('useCart must be used within CartProvider');
  }
  return context;
}

// ============================================
// 5. ä½¿ç”¨ä¾‹ - å„ãƒ¬ãƒ™ãƒ«ã®çŠ¶æ…‹ãŒé©åˆ‡ã«åˆ†é›¢
// ============================================

function App() {
  return (
    <CartProvider>
      <Header />
      <ProductList />
      <CartSummary />
    </CartProvider>
  );
}

// ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚«ãƒ¼ãƒˆæ•°ã®ã¿ä½¿ç”¨ï¼ˆéƒ¨åˆ†è³¼èª­ï¼‰
function Header() {
  const { itemCount } = useCart();

  return (
    <header>
      <h1>ã‚·ãƒ§ãƒƒãƒ—</h1>
      <span>ğŸ›’ {itemCount}</span>
    </header>
  );
}

// ã‚«ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼: åˆè¨ˆã¨æ“ä½œã‚’ä½¿ç”¨
function CartSummary() {
  const { state, total, clearCart } = useCart();

  if (state.items.length === 0) {
    return <p>ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>;
  }

  return (
    <aside>
      <h2>ã‚«ãƒ¼ãƒˆ</h2>
      <ul>
        {state.items.map((item) => (
          <li key={item.id}>
            {item.name} Ã— {item.quantity} = Â¥{item.price * item.quantity}
          </li>
        ))}
      </ul>
      <p>åˆè¨ˆ: Â¥{total}</p>
      <button onClick={clearCart}>ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã™ã‚‹</button>
    </aside>
  );
}

// å•†å“è¿½åŠ ãƒœã‚¿ãƒ³: addItem ã®ã¿ä½¿ç”¨
function AddToCartButton({ product }: { product: Product }) {
  const { addItem } = useCart();

  return (
    <button onClick={() => addItem(product)}>ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
  );
}

// --- å‹å®šç¾© ---
type Product = {
  id: string;
  name: string;
  price: number;
};

// --- ãƒ€ãƒŸãƒ¼ãƒ•ãƒƒã‚¯ ---
function useProducts(): Product[] {
  return [
    { id: '1', name: 'å•†å“A', price: 1000 },
    { id: '2', name: 'å•†å“B', price: 2000 },
  ];
}

function Modal({ children, onClose }: { children: ReactNode; onClose: () => void }) {
  return (
    <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)' }}>
      <div style={{ background: 'white', padding: '20px', margin: '100px auto', maxWidth: '400px' }}>
        {children}
        <button onClick={onClose}>é–‰ã˜ã‚‹</button>
      </div>
    </div>
  );
}

function ProductDetail({ product }: { product: Product }) {
  return <div>{product.name}ã®è©³ç´°æƒ…å ±</div>;
}

function ProductPreview({ productId }: { productId: string | null }) {
  if (!productId) return <div>å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„</div>;
  return <div>é¸æŠä¸­: {productId}</div>;
}

export default App;
```

---

## ã‚ˆãã‚ã‚‹é–“é•ã„ï¼ˆPitfallsï¼‰

### 1. ãªã‚“ã§ã‚‚Contextï¼ˆéå‰°ãªã‚°ãƒ­ãƒ¼ãƒãƒ«åŒ–ï¼‰

ã€Œè¤‡æ•°ã§ä½¿ã†ã‹ã‚‰ã€ã¨ã„ã†ç†ç”±ã ã‘ã§Contextã«ã™ã‚‹ã¨ã€ä¿å®ˆæ€§ãŒä¸‹ãŒã‚Šã¾ã™ã€‚

```tsx
// âŒ é–“é•ã„ - ãªã‚“ã§ã‚‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã™ã‚‹
const AppContext = createContext({
  user: null,
  theme: 'light',
  isMenuOpen: false,         // â† ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã§ã—ã‹ä½¿ã‚ãªã„
  selectedProductId: null,   // â† å•†å“ãƒšãƒ¼ã‚¸ã§ã—ã‹ä½¿ã‚ãªã„
  searchQuery: '',           // â† æ¤œç´¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã—ã‹ä½¿ã‚ãªã„
  // ... 20å€‹ä»¥ä¸Šã®state
});

// âœ… æ­£ã—ã„ - ã‚¹ã‚³ãƒ¼ãƒ—ã«å¿œã˜ã¦åˆ†é›¢
// Globalï¼ˆã‚¢ãƒ—ãƒªå…¨ä½“ï¼‰
const AuthContext = createContext({ user: null });
const ThemeContext = createContext({ theme: 'light' });

// Localï¼ˆä½¿ã†å ´æ‰€ã§ç®¡ç†ï¼‰
function Header() {
  const [isMenuOpen, setIsMenuOpen] = useState(false); // â† ãƒ­ãƒ¼ã‚«ãƒ«ã§ååˆ†
}

function ProductPage() {
  const [selectedId, setSelectedId] = useState(null); // â† ãƒšãƒ¼ã‚¸å†…ã§ååˆ†
}
```

**ãªãœèµ·ãã‚‹ã‹**: ã€ŒçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã¹ãã€ã¨ã„ã†æ€ã„è¾¼ã¿ã€‚props drillingã‚’éåº¦ã«æã‚Œã¦ã„ã‚‹ã€‚

**ã©ã†é˜²ãã‹**: ã€Œã“ã®çŠ¶æ…‹ã¯èª°ãŒä½¿ã†ï¼Ÿã€ã‚’è‡ªå•ã™ã‚‹ã€‚1-2ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªã‚‰Localã€3å±¤ä»¥ä¸Šã®props drillãªã‚‰Liftedã‹Contextã€‚

### 2. å·¨å¤§Reducerï¼ˆ1ã¤ã®Reducerã«å…¨éƒ¨è©°ã‚è¾¼ã‚€ï¼‰

1ã¤ã®Reducerã«é–¢é€£ã®ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è©°ã‚è¾¼ã‚€ã¨ã€è¦‹é€šã—ãŒæ‚ªããªã‚Šã¾ã™ã€‚

```tsx
// âŒ é–“é•ã„ - 1ã¤ã®Reducerã«å…¨éƒ¨è©°ã‚è¾¼ã‚€
type AppAction =
  | { type: 'SET_USER'; payload: User }
  | { type: 'LOGOUT' }
  | { type: 'ADD_TO_CART'; payload: Product }
  | { type: 'REMOVE_FROM_CART'; payload: string }
  | { type: 'SET_THEME'; payload: 'light' | 'dark' }
  | { type: 'OPEN_MODAL'; payload: string }
  | { type: 'CLOSE_MODAL' }
  // ... 50ç¨®é¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

function appReducer(state, action) {
  switch (action.type) {
    // 500è¡Œä»¥ä¸Šã®switchæ–‡...
  }
}

// âœ… æ­£ã—ã„ - è²¬å‹™ã”ã¨ã«Reducerã‚’åˆ†å‰²
function authReducer(state, action) { /* èªè¨¼ã®ã¿ */ }
function cartReducer(state, action) { /* ã‚«ãƒ¼ãƒˆã®ã¿ */ }
function uiReducer(state, action) { /* UIçŠ¶æ…‹ã®ã¿ */ }

// ãã‚Œãã‚Œåˆ¥ã®Contextã§æä¾›
<AuthProvider>
  <CartProvider>
    <UIProvider>
      {children}
    </UIProvider>
  </CartProvider>
</AuthProvider>
```

**ãªãœèµ·ãã‚‹ã‹**: Reduxã®ã€Œsingle source of truthã€ã‚’èª¤è§£ã—ã¦ã„ã‚‹ã€‚åˆ†å‰²ã—ã¦ã‚‚single source of truthã¯ä¿ã¦ã‚‹ã€‚

**ã©ã†é˜²ãã‹**: ã€Œã“ã®çŠ¶æ…‹ç¾¤ã¯åŒæ™‚ã«å¤‰æ›´ã•ã‚Œã‚‹ã‹ï¼Ÿã€ã‚’è€ƒãˆã‚‹ã€‚åˆ¥ã€…ã«å¤‰æ›´ã•ã‚Œã‚‹ãªã‚‰ã€åˆ¥ã€…ã®Reducerã«ã™ã‚‹ã€‚

### 3. UI State ã¨ Domain State ã®æ··åŒ

UIã®è¦‹ãŸç›®çŠ¶æ…‹ï¼ˆé–‹é–‰ã€é¸æŠï¼‰ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã€å•†å“ï¼‰ã‚’æ··ãœã‚‹ã¨ã€ãƒã‚°ã®æ¸©åºŠã«ãªã‚Šã¾ã™ã€‚

```tsx
// âŒ é–“é•ã„ - UIã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ··ãœã‚‹
type State = {
  users: User[];              // Domain
  selectedUserId: string;     // UI
  isLoading: boolean;         // UI
  sortOrder: 'asc' | 'desc';  // UI
  editingUser: User | null;   // UI
};

// å•é¡Œç‚¹:
// - usersã®æ›´æ–°ã¨sortOrderã®æ›´æ–°ãŒåŒã˜Reducerã§èµ·ãã‚‹
// - ãƒ†ã‚¹ãƒˆãŒè¤‡é›‘ã«ãªã‚‹
// - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ãŒç«‹ã¦ã«ãã„

// âœ… æ­£ã—ã„ - UIã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ†é›¢
// Domainï¼ˆã‚µãƒ¼ãƒãƒ¼ã¨åŒæœŸï¼‰
const { data: users, isLoading } = useQuery(['users'], fetchUsers);

// UIï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§ç®¡ç†ï¼‰
const [selectedUserId, setSelectedUserId] = useState<string | null>(null);
const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');

// æ´¾ç”Ÿå€¤ã¯è¨ˆç®—ã™ã‚‹
const sortedUsers = useMemo(
  () => [...(users ?? [])].sort((a, b) =>
    sortOrder === 'asc'
      ? a.name.localeCompare(b.name)
      : b.name.localeCompare(a.name)
  ),
  [users, sortOrder]
);
```

**ãªãœèµ·ãã‚‹ã‹**: ã€ŒçŠ¶æ…‹ã€ã‚’ä¸€æ‹¬ã‚Šã«è€ƒãˆã€ç¨®é¡ã®é•ã„ã‚’æ„è­˜ã—ã¦ã„ãªã„ã€‚

**ã©ã†é˜²ãã‹**: ã€Œã“ã®çŠ¶æ…‹ã¯ã‚µãƒ¼ãƒãƒ¼ã«ã‚ã‚‹ã¹ãã‹ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã‘ã§æŒã¤ã¹ãã‹ã€ã‚’è€ƒãˆã‚‹ã€‚ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã¯TanStack Queryãªã©ã§ç®¡ç†ã€‚

### 4. æ›´æ–°è²¬å‹™ã®åˆ†æ•£ï¼ˆã©ã“ã§æ›´æ–°ã•ã‚Œã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ï¼‰

åŒã˜çŠ¶æ…‹ã‚’è¤‡æ•°ç®‡æ‰€ã‹ã‚‰ç›´æ¥æ›´æ–°ã™ã‚‹ã¨ã€ãƒã‚°ã®è¿½è·¡ãŒå›°é›£ã«ãªã‚Šã¾ã™ã€‚

```tsx
// âŒ é–“é•ã„ - è¤‡æ•°ç®‡æ‰€ã‹ã‚‰ç›´æ¥æ›´æ–°
// ComponentA.tsx
setUser({ ...user, name: newName });

// ComponentB.tsx
setUser({ ...user, email: newEmail });

// ComponentC.tsx
setUser(null);

// å•é¡Œç‚¹: userãŒã©ã“ã§æ›´æ–°ã•ã‚Œã‚‹ã‹æŠŠæ¡ã§ããªã„

// âœ… æ­£ã—ã„ - æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’1ç®‡æ‰€ã«é›†ç´„
// useUser.ts
function useUser() {
  const [user, setUser] = useState<User | null>(null);

  // æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã¯å…¨ã¦ã“ã“ã«é›†ç´„
  const updateName = (name: string) => {
    setUser((prev) => prev ? { ...prev, name } : null);
  };

  const updateEmail = (email: string) => {
    setUser((prev) => prev ? { ...prev, email } : null);
  };

  const logout = () => {
    setUser(null);
  };

  return { user, updateName, updateEmail, logout };
}

// ComponentA.tsx
const { updateName } = useUser();
updateName(newName); // æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’çŸ¥ã‚‰ãªãã¦ã„ã„

// ComponentB.tsx
const { updateEmail } = useUser();
updateEmail(newEmail);
```

**ãªãœèµ·ãã‚‹ã‹**: ã€ŒçŠ¶æ…‹ã‚’å…±æœ‰ã™ã‚Œã°ã„ã„ã€ã¨è€ƒãˆã€æ›´æ–°ã®è²¬å‹™ã‚’æ„è­˜ã—ã¦ã„ãªã„ã€‚

**ã©ã†é˜²ãã‹**: çŠ¶æ…‹ã¨æ›´æ–°é–¢æ•°ã‚’**ã‚»ãƒƒãƒˆã§æä¾›**ã™ã‚‹ã€‚setStateã‚’ç›´æ¥å…¬é–‹ã—ãªã„ã€‚

---

## Design Decisions

### ãªãœã€ŒGlobal State ã¯æœ€å¾Œã®æ‰‹æ®µã€ãªã®ã‹

**ç†ç”±**: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã¯ä¾å­˜é–¢ä¿‚ãŒè¦‹ãˆã«ããã€ãƒ†ã‚¹ãƒˆãŒå›°é›£ã«ãªã‚‹ã€‚Localã§æ¸ˆã‚€ãªã‚‰ã€LocalãŒæœ€å–„ã€‚

**ä»–ã®é¸æŠè‚¢**:
- å…¨éƒ¨ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã™ã‚‹ â†’ ä¾å­˜ãŒè¤‡é›‘åŒ–ã€ãƒ†ã‚¹ãƒˆå›°é›£ã€ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—å¤§
- å…¨éƒ¨Localã«ã™ã‚‹ â†’ props drillingãŒæ·±ããªã‚Šã™ãã‚‹

**ç ´ç¶»æ¡ä»¶**:
- 5å±¤ä»¥ä¸Šã®props drillingãŒç™ºç”Ÿã—ãŸã‚‰ã€Contextã‚’æ¤œè¨
- æ›´æ–°é »åº¦ãŒé«˜ãå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒå•é¡Œãªã‚‰ã€å¤–éƒ¨ã‚¹ãƒˆã‚¢ã‚’æ¤œè¨

### ãªãœã€ŒçŠ¶æ…‹ã®å¯¿å‘½ã€ã‚’è€ƒãˆã‚‹ã®ã‹

**ç†ç”±**: å¯¿å‘½ã«å¿œã˜ãŸç®¡ç†æ–¹æ³•ã‚’é¸ã¶ã¨ã€ä¸è¦ãªçŠ¶æ…‹ã®æ®‹ç•™ã‚„ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ã’ã‚‹ã€‚

**ä»–ã®é¸æŠè‚¢**:
- å…¨éƒ¨æ°¸ç¶šåŒ–ã™ã‚‹ â†’ localStorageãŒè‚¥å¤§åŒ–ã€å¤ã„ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã‚‹
- å…¨éƒ¨ä¸€æ™‚çš„ã«ã™ã‚‹ â†’ ãƒšãƒ¼ã‚¸é·ç§»ã§çŠ¶æ…‹ãŒæ¶ˆãˆã€UXãŒæ‚ªåŒ–

**ç ´ç¶»æ¡ä»¶**:
- ã€Œãƒšãƒ¼ã‚¸é›¢è„±ã—ã¦ã‚‚æ®‹ã£ã¦ã»ã—ã„ã€â†’ æ°¸ç¶šåŒ–ãŒå¿…è¦
- ã€Œä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚å…±æœ‰ã€â†’ ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã¨ã—ã¦ç®¡ç†

### ãªãœã€ŒUI State ã¨ Domain Stateã€ã‚’åˆ†ã‘ã‚‹ã®ã‹

**ç†ç”±**:
- Domain State ã¯ã‚µãƒ¼ãƒãƒ¼ã¨ã®åŒæœŸã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€å†å–å¾—ãŒå¿…è¦
- UI State ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Œçµã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ç”Ÿæ­»ã‚’å…±ã«ã™ã‚‹

**ä»–ã®é¸æŠè‚¢**:
- å…¨éƒ¨1ã¤ã®ã‚¹ãƒˆã‚¢ã§ç®¡ç† â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ãŒè¤‡é›‘åŒ–ã€ãƒ†ã‚¹ãƒˆå›°é›£

**ç ´ç¶»æ¡ä»¶**:
- ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒªã§åˆ†é›¢ãŒã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã«ãªã‚‹å ´åˆã¯ã€çµ±åˆã—ã¦ã‚‚ã‚ˆã„
- ãŸã ã—è¦æ¨¡ãŒå¤§ãããªã£ãŸã‚‰å¿…ãšåˆ†é›¢ã™ã‚‹

---

## ç¾å ´ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] **ã‚¹ã‚³ãƒ¼ãƒ—ã¯é©åˆ‡ã‹**: Local ã§æ¸ˆã‚€ã‚‚ã®ã‚’ Global ã«ã—ã¦ã„ãªã„ã‹
- [ ] **å¯¿å‘½ã‚’è€ƒæ…®ã—ãŸã‹**: ä¸€æ™‚çš„ãªçŠ¶æ…‹ã‚’æ°¸ç¶šåŒ–ã—ã¦ã„ãªã„ã‹ã€ãã®é€†ã‚‚
- [ ] **UI / Domain åˆ†é›¢**: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨UIçŠ¶æ…‹ãŒæ··åœ¨ã—ã¦ã„ãªã„ã‹
- [ ] **æ›´æ–°è²¬å‹™ã®é›†ç´„**: åŒã˜çŠ¶æ…‹ã‚’è¤‡æ•°ç®‡æ‰€ã‹ã‚‰ç›´æ¥æ›´æ–°ã—ã¦ã„ãªã„ã‹
- [ ] **props drilling**: 3å±¤ã‚’è¶…ãˆãŸã‚‰ Lifted ã‹ Context ã‚’æ¤œè¨
- [ ] **å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: Context ã® value ã‚’ãƒ¡ãƒ¢åŒ–ã—ã¦ã„ã‚‹ã‹

---

## ã¾ã¨ã‚

| æ¦‚å¿µ | èª¬æ˜ |
|------|------|
| ã‚¹ã‚³ãƒ¼ãƒ—åˆ¤æ–­ | Local â†’ Lifted â†’ Global ã®é †ã§æ¤œè¨ |
| çŠ¶æ…‹ã®å¯¿å‘½ | ä¸€æ™‚çš„ / ãƒšãƒ¼ã‚¸ / ã‚»ãƒƒã‚·ãƒ§ãƒ³ / æ°¸ç¶š |
| UI vs Domain | UIã¯ Localã€Domain ã¯ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç®¡ç† |
| æ›´æ–°è²¬å‹™ | çŠ¶æ…‹ã¨æ›´æ–°é–¢æ•°ã‚’ã‚»ãƒƒãƒˆã§æä¾› |

---

## ç·´ç¿’å•é¡Œ

1. **æ˜“**: æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å€¤ï¼ˆqueryï¼‰ã¨ã€æ¤œç´¢çµæœã®é¸æŠçŠ¶æ…‹ï¼ˆselectedIdï¼‰ã‚’ã€ãã‚Œãã‚Œé©åˆ‡ãªã‚¹ã‚³ãƒ¼ãƒ—ã§ç®¡ç†ã—ã¦ãã ã•ã„ã€‚ã©ã¡ã‚‰ã‚’Localã«ã—ã€ã©ã¡ã‚‰ã‚’Liftedã«ã™ã¹ãã‹èª¬æ˜ã—ã¦ãã ã•ã„ã€‚

2. **æ™®é€š**: Eã‚³ãƒãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã§ä»¥ä¸‹ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹è¨­è¨ˆã‚’ã—ã¦ãã ã•ã„ï¼š
   - å•†å“ä¸€è¦§ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ï¼‰
   - ã‚«ãƒ¼ãƒˆã®ä¸­èº«ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ä¿æŒï¼‰
   - å•†å“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‹é–‰
   - ã‚½ãƒ¼ãƒˆé †

   ãã‚Œãã‚Œã®çŠ¶æ…‹ã«ã¤ã„ã¦ã€ã€Œèª°ãŒä½¿ã†ã‹ã€ã€Œã„ã¤æ¶ˆãˆã‚‹ã¹ãã‹ã€ã€Œã©ã®æ–¹æ³•ã§ç®¡ç†ã™ã‚‹ã‹ã€ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚

3. **å¿œç”¨ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å‹ï¼‰**: ä»¥ä¸‹ã®çŠ¶æ…‹ç®¡ç†è¨­è¨ˆã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚å•é¡Œç‚¹ã‚’3ã¤ä»¥ä¸ŠæŒ‡æ‘˜ã—ã€æ”¹å–„æ¡ˆã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚

```tsx
// store.ts
const useAppStore = create((set) => ({
  // èªè¨¼
  user: null,
  setUser: (user) => set({ user }),

  // ã‚«ãƒ¼ãƒˆ
  cartItems: [],
  addToCart: (item) => set((s) => ({ cartItems: [...s.cartItems, item] })),

  // UI
  isMenuOpen: false,
  toggleMenu: () => set((s) => ({ isMenuOpen: !s.isMenuOpen })),

  isMobileView: window.innerWidth < 768,
  setIsMobileView: (v) => set({ isMobileView: v }),

  // å•†å“ãƒšãƒ¼ã‚¸
  selectedProductId: null,
  setSelectedProductId: (id) => set({ selectedProductId: id }),

  // æ¤œç´¢
  searchQuery: '',
  setSearchQuery: (q) => set({ searchQuery: q }),
  searchResults: [],
  setSearchResults: (r) => set({ searchResults: r }),
}));
```

**è¦³ç‚¹**: ã‚¹ã‚³ãƒ¼ãƒ—ã®é©åˆ‡æ€§ã€è²¬å‹™ã®åˆ†é›¢ã€çŠ¶æ…‹ã®å¯¿å‘½ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«åŒ–ã®å¦¥å½“æ€§
