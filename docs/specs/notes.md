# ノート機能

## 概要

レッスンごとに学習メモを作成・編集・削除できる機能。Markdownエディタとプレビューを提供。

## ユーザーストーリー

- [x] ユーザーはレッスンを選択してノートを作成できる
- [x] ユーザーはMarkdown形式でノートを書ける
- [x] ユーザーはリアルタイムでプレビューを確認できる
- [x] ユーザーのノートは自動保存される
- [x] ユーザーはノートを削除できる
- [x] ユーザーはレッスン名で検索できる
- [x] ユーザーはレッスン詳細から直接ノートを開ける

## 画面・導線

| パス | 画面名 | 説明 |
|------|--------|------|
| /notes | ノート | サイドバー（レッスン一覧）+ メイン（エディタ/プレビュー） |
| /notes?lessonId=:id | ノート（レッスン指定） | 指定レッスンが選択された状態で開く |

### レイアウト

```
┌─────────────────────────────────────────────────┐
│ Header                                          │
├──────────────┬──────────────────────────────────┤
│ Sidebar      │ Main                             │
│              │                                  │
│ [検索]       │ レッスン: React入門              │
│              │ ステータス: 保存済み             │
│ ・React入門  │                                  │
│ ・useState   │ ┌────────────┬────────────┐     │
│ ・useEffect  │ │ Editor     │ Preview    │     │
│   ...        │ │            │            │     │
│              │ │            │            │     │
│              │ └────────────┴────────────┘     │
│              │                                  │
│              │ [削除]                           │
└──────────────┴──────────────────────────────────┘
```

## データ構造

```typescript
interface Note {
  lessonId: string;
  markdown: string;
  createdAt: string;  // ISO 8601
  updatedAt: string;  // ISO 8601
}

// LocalStorage構造
interface NotesStorage {
  notesByLessonId: Record<string, Note>;
}
```

## 状態管理

- 永続化: LocalStorage（`notes-storage`）
- 自動保存: 500msデバウンス
- 検索: 300msデバウンス

### 保存ステータス

| 状態 | 表示 |
|------|------|
| idle | （なし） |
| saving | 保存中... |
| saved | 保存済み |
| error | 保存エラー |

## 受け入れ条件

- [x] レッスン一覧がサイドバーに表示される
- [x] ノートがあるレッスンにインジケータが表示される
- [x] レッスン選択でエディタが表示される
- [x] 入力中は「保存中...」と表示される
- [x] 保存完了で「保存済み」と表示される
- [x] Markdownがリアルタイムでプレビューされる
- [x] 削除確認ダイアログが表示される
- [x] URLパラメータで指定レッスンが選択される

## エッジケース

- 未選択状態: 「レッスンを選択してください」を表示
- 空のノート: 削除と同等に扱う（保存しない）
- LocalStorage容量超過: エラーステータスを表示

## 関連

- [レッスン機能](./lessons.md)
